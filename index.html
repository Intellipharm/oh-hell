<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Oh Hell!</title>

    <!-- angular -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js" integrity="sha256-3SrLjPeRPa1ofM280r+OMcUjJZKLWJHr6SRtRu3dRb0=" crossorigin="anonymous"></script>

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta/css/bootstrap-reboot.min.css" integrity="sha256-ZeIRHNBrNlXFlcfvaKsx9S1BOwWJ42hBund78iurMLw=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha256-m/h/cUDAhf6/iBRixTbuc8+Rg2cIETQtPcH9D3p2Kg0=" crossorigin="anonymous" />

    <!-- chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js" integrity="sha256-+q+dGCSrVbejd3MDuzJHKsk2eXd4sF5XYEMfPZsOnYE=" crossorigin="anonymous"></script>

    <!-- local -->
    <link rel="stylesheet" href="styles/index.css" />
    <link rel="stylesheet" href="styles/icons.css" />

    <script src="js/index.js"></script>
    <script src="js/controller.js"></script>
    <script src="js/components.js"></script>
  </head>
  <body ng-controller="AppController as App" ng-class="{'dark': App.darkTheme}">
      <div class="container-fluid">
          <h1>Oh Hell!</h1>
          <div class="row" ng-if="App.game">
              <div class="col-xl-9 pb-3 mb-3 border border-top-0 border-right-0 border-left-0 border-dark">
                  <div class="row" ng-if="App.game.isFinished">
                      <div class="col-sm" style="font-size:3em;" ng-repeat="leader in App.game.leaderboard">
                          <div class="text-ellipsis">{{leader.player}}</div>
                          <div>{{leader.points}}</div>
                      </div>
                  </div>
                  <div ng-if="!App.game.isFinished">
                      <div class="col-md text-center tie-break" ng-show="App.game.isLeaderTied">
                        Tie Break Round!
                      </div>
                      <div class="col-md text-center current-round" ng-show="!App.showFullScore">
                          <div class="row">
                              <div class="col-md">
                                  <h3>Dealer</h3>
                                  <p>{{App.game.settings.players[App.game.rounds[App.game.currentRound.index].dealer]}}</p>
                                  <p>{{App.calculateBidderRestriction(App.game.currentRound.index)}}</p>
                              </div>
                              <div class="col-md">
                                  <h3>Cards</h3>
                                  <p class="largest-text">
                                    {{App.game.rounds[App.game.currentRound.index].cardCount}}<suit suit="App.game.rounds[App.game.currentRound.index].card.suit"></suit>
                                  </p>
                              </div>
                              <div class="col-md d-none d-lg-block">
                                  <h3>Bids</h3>
                                  <p>
                                    There are
                                    <span ng-class="{
                                      'underbid': App.calculateTotalBids(App.game.currentRound.index) < App.game.rounds[App.game.currentRound.index].cardCount,
                                      'accurate-bid': App.calculateTotalBids(App.game.currentRound.index) === App.game.rounds[App.game.currentRound.index].cardCount,
                                      'overbid': App.calculateTotalBids(App.game.currentRound.index) > App.game.rounds[App.game.currentRound.index].cardCount,
                                    }">{{App.calculateTotalBids(App.game.currentRound.index)}} </span>
                                    bids from <b>{{App.game.rounds[App.game.currentRound.index].cardCount}}</b> possible wins
                                  </p>
                                  <p>{{App.calculateBlindBidsDescription(App.game.currentRound.index)}}</p>
                              </div>
                              <div class="col-md" ng-if="App.game.settings.allowSuperTrump">
                                  <h3>Super Trump</h3>
                                  <p ng-if="App.game.rounds[App.game.currentRound.index].card.suit === 'N'">
                                    N/A for No Trumps
                                  </p>
                                  <card
                                      ng-if="App.game.rounds[App.game.currentRound.index].card.suit !== 'N'"
                                      suit="App.game.rounds[App.game.currentRound.index].card.suit"
                                      name="App.game.rounds[App.game.currentRound.index].card.name"
                                      size="small"
                                  ></card>
                              </div>
                          </div>
                      </div>

                      <div class="row players-wrapper text-center">
                          <div class="col-md" ng-show="App.showFullScore">Round</div>
                          <div class="col-md player" ng-repeat="(playerIndex, player) in App.game.settings.players">
                              <div class="text-ellipsis">{{player}}</div>
                              <div class="text-small">Points: {{App.calculateTotalPoints(playerIndex)}}</div>
                              <!-- <div class="text-small">Bids: {{App.calculateAccurateBidCount(playerIndex, App.game.currentRound.index)}} / {{App.game.currentRound.index}} ({{App.calculateBidAccuracy(playerIndex, App.game.currentRound.index)}}%)</div> -->

                              <div class="round-wrapper" ng-show="!App.showFullScore">
                                  <div class="col-md" ng-show="!App.game.currentRound.started">
                                      <label>
                                          Bid
                                          <input type="number" min="0" max="10" class="form-control" ng-model="App.game.rounds[App.game.currentRound.index].players[playerIndex].bid" />
                                      </label>
                                      <label ng-show="App.eligibleForBlindBid(playerIndex, App.game.currentRound.index)">
                                          Blind Bid
                                          <input type="checkbox" ng-model="App.game.rounds[App.game.currentRound.index].players[playerIndex].blind" />
                                      </label>
                                  </div>

                                  <div class="col-md" ng-show="App.game.currentRound.started">
                                      <label>
                                          Tricks
                                          {{App.game.rounds[App.game.currentRound.index].players[playerIndex].bid}} / <input type="number" min="0" max="10" class="form-control" ng-model="App.game.rounds[App.game.currentRound.index].players[playerIndex].tricks" />
                                      </label>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <div class="row scores-wrapper" ng-repeat="(roundIndex, round) in App.game.rounds" ng-show="App.showFullScore">
                          <div class="col-md">{{round.cardCount}}{{round.card.suit}} - {{App.game.settings.players[round.dealer]}}</div>
                          <div class="col-md score" ng-repeat="(playerIndex, player) in App.game.settings.players">
                              <input type="checkbox" ng-model="App.game.rounds[roundIndex].players[playerIndex].blind" ng-show="App.eligibleForBlindBid(playerIndex, roundIndex)" title="Blind Bid" />
                              <input type="number" min="0" max="10" class="form-control" title="Bid" placeholder="Bid" ng-model="App.game.rounds[roundIndex].players[playerIndex].bid" />
                              <input type="number" min="0" max="10" class="form-control" title="Tricks Won" placeholder="Tricks Won" ng-model="App.game.rounds[roundIndex].players[playerIndex].tricks" />
                              {{App.game.rounds[roundIndex].players[playerIndex].points}}
                          </div>
                      </div>


                      <div class="row" ng-show="!App.showFullScore">
                          <div class="col-md">
                              <button class="btn btn-primary" ng-click="App.startRound()" ng-show="!App.game.currentRound.started">Start Round</button>
                              <button class="btn btn-primary" ng-click="App.nextRound()" ng-show="App.game.currentRound.started">Next Round</button>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="col-xl-3">
                  <div class="actions-wrapper">
                      <button class="btn btn-primary" ng-click="App.toggleStoreView()" ng-if="!App.game.isFinished">Toggle Score View</button>
                      <button class="btn btn-primary" ng-click="App.toggleTheme()">Toggle Theme</button>
                      <button class="btn btn-primary" ng-click="App.createNewGame()">Create new game</button>
                  </div>
                  <div class="stats-wrapper">
                      <canvas id="chart-bid-scores" height="200" width="175"></canvas>
                      <canvas id="chart-bid-accuracy" height="200" width="250"></canvas>
                      <canvas id="chart-bid-counts" height="200" width="250"></canvas>
                  </div>
              </div>
          </div>
          <div class="row" ng-if="!App.game">
              <div class="col-md">
                  <div class="settings-wrapper">
                      <h2>Start new game</h2>

                      <h3>Players</h3>

                      <div class="form-group">
                          <label for="new-player-name">New player name</label>
                          <div class="input-group">
                              <input type="text" class="form-control" id="new-player-name" placeholder="New player name" ng-model="App.newPlayerName" />
                              <span class="input-group-addon btn btn-primary" ng-click="App.addNewPlayer()"><i class="icons-user-plus"></i> Add player</span>
                          </div>
                      </div>

                      <div ng-repeat="(playerIndex, player) in App.settings.players">
                          {{player}}
                          <button class="btn btn-primary" title="Move player up" ng-click="App.movePlayerUp(playerIndex)"><i class="icons-move-up"></i></button>
                          <button class="btn btn-primary" title="Move player down" ng-click="App.movePlayerDown(playerIndex)"><i class="icons-move-down"></i></button>
                          <button class="btn btn-danger" title="Remove player" ng-click="App.removePlayer(playerIndex)"><i class="icons-user-minus"></i></button>
                      </div>

                      <h3>Rounds</h3>

                      <div class="form-group">
                          <label for="first-round">Number of cards in first round</label>
                          <input type="number" min="1" max="10" class="form-control" id="first-round" placeholder="Number of cards in first round" ng-model="App.settings.cardsInFirstRound" />
                      </div>
                      <div class="form-group">
                          <label for="first-round">Number of cards in last round</label>
                          <input type="number" min="1" max="10" class="form-control" id="last-round" placeholder="Number of cards in last round" ng-model="App.settings.cardsInLastRound" />
                      </div>
                      <div class="form-group">
                          <label for="mirror-round">Should the rounds be mirrored?</label>
                          <input type="checkbox" id="mirror-round" ng-model="App.settings.mirrorRounds" />
                      </div>

                      <h3>Trumps</h3>

                      <div class="form-group">
                          <label for="allow-no-trumps">Allow no trumps?</label>
                          <input type="checkbox" id="allow-no-trumps" ng-model="App.settings.allowNoTrumps" />
                      </div>

                      <div class="form-group">
                          <label for="allow-super-trump">Show super trump? (The card drawn to determine the suit of the round becomes the highest trump card for that round)</label>
                          <input type="checkbox" id="allow-super-trump" ng-model="App.settings.allowSuperTrump" />
                      </div>

                      <h3>Points Per Trick</h3>

                      <div class="form-group">
                          <label for="points-win-per-trick">Win points per trick won?</label>
                          <input type="checkbox" id="points-win-per-trick" ng-model="App.settings.winPointsPerTrick" />
                      </div>
                      <div class="form-group">
                          <label for="points-win-per-trick-successful">Only if successful?</label>
                          <input type="checkbox" id="points-win-per-trick-successful" ng-model="App.settings.winPointsPerTrickIfSuccessful" />
                      </div>
                      <div class="form-group">
                          <label for="points-win-per-trick-zero">0 should win half a point?</label>
                          <input type="checkbox" id="points-win-per-trick-zero" ng-model="App.settings.winPointsPerTrickIfZero" />
                      </div>
                      <div class="form-group">
                          <label for="points-lose-per-difference">Lose points per trick/bid difference?</label>
                          <input type="checkbox" id="points-lose-per-difference" ng-model="App.settings.losePointsPerDifference" />
                      </div>

                      <h3>Points On Success</h3>

                      <div class="form-group">
                          <label for="points-successful-bid">Fixed bonus points for successful bid</label>
                          <input type="number" min="0" max="30" class="form-control" id="points-successful-bid" placeholder="Fixed bonus points for successful bid" ng-model="App.settings.pointsSuccessfulBid" />
                      </div>

                      <div class="form-group">
                          <label for="points-successful-bid-variable">Award bonus points equal to the number of cards dealt?</label>
                          <input type="checkbox" id="points-successful-bid-variable" ng-model="App.settings.pointsSuccessfulVariable" />
                      </div>

                      <div class="form-group">
                          <label for="points-successful-bid-inverse">Award bonus points inverse to the number of cards dealt?</label>
                          <input type="checkbox" id="points-successful-bid-inverse" ng-model="App.settings.pointsSuccessfulInverse" />
                      </div>

                      <h3>Points On Failure</h3>

                      <div class="form-group">
                          <label for="points-unsuccessful-bid">Bonus points for unsuccessful bid</label>
                          <input type="number" min="-30" max="0" class="form-control" id="points-unsuccessful-bid" placeholder="Bonus points for unsuccessful bid" ng-model="App.settings.pointsUnsuccessfulBid" />
                      </div>

                      <div class="form-group">
                          <label for="points-unsuccessful-bid-variable">Reduce bonus points equal to the number of cards dealt?</label>
                          <input type="checkbox" id="points-unsuccessful-bid-variable" ng-model="App.settings.pointsUnsuccessfulVariable" />
                      </div>

                      <div class="form-group">
                          <label for="points-unsuccessful-bid-inverse">Reduce bonus points inverse to the number of cards dealt?</label>
                          <input type="checkbox" id="points-unsuccessful-bid-inverse" ng-model="App.settings.pointsUnsuccessfulInverse" />
                      </div>

                      <h3>Blind Bidding</h3>

                      <div class="form-group">
                          <label for="blind-bid-points-threshold">Blind bidding points behind leader threshold</label>
                          <input type="number" min="0" max="30" class="form-control" id="blind-bid-points-threshold" placeholder="Blind bidding points behind leader threshold" ng-model="App.settings.blindBidThreshold" />
                      </div>

                      <div class="form-group">
                          <label for="blind-bid-bonus">Blind bidding fixed bonus points</label>
                          <input type="number" min="0" max="30" class="form-control" id="blind-bid-bonus" placeholder="Blind bidding bonus points" ng-model="App.settings.blindBidBonus" />
                      </div>

                      <div class="form-group">
                          <label for="blind-bid-double">Blind bidding should double the points in the round?</label>
                          <input type="checkbox" id="blind-bid-double" ng-model="App.settings.blindBidDouble" />
                      </div>

                      <button class="btn btn-success" ng-click="App.startGame()">Start game</button>
                  </div>
              </div>
          </div>
      </div>
  </body>
</html>
